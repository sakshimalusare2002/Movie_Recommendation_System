<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Liked Movies</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Google Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: #f4f6f9;
      color: #333;
    }

    .header {
      padding: 20px;
      text-align: center;
      background-color: #fff;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .header h2 {
      color: #e74c3c;
      font-weight: 600;
      font-size: 26px;
    }

    .movie-grid {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      padding: 20px;
    }

    .movie-card {
      background-color: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
      width: 220px;
    }

    .movie-card:hover {
      transform: translateY(-5px);
    }

    .poster-wrapper {
      position: relative;
      height: 320px;
      overflow: hidden;
    }

    .movie-poster {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .movie-title {
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      margin: 10px 0 6px;
      color: #2c3e50;
    }

    .overlay-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding-bottom: 15px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background-color: #3498db;
      color: #fff;
      transition: background-color 0.3s ease;
      text-decoration: none;
    }

    .btn:hover {
      background-color: #2980b9;
    }

    .btn.disabled {
      background-color: gray;
      cursor: default;
    }

    .no-movies {
      text-align: center;
      font-size: 18px;
      color: #888;
      margin-top: 40px;
    }

    @media (max-width: 768px) {
      .movie-card {
        width: 45%;
      }
    }

    @media (max-width: 480px) {
      .movie-card {
        width: 100%;
      }

      .overlay-buttons {
        flex-direction: column;
        align-items: center;
      }

      .btn {
        width: 80%;
        text-align: center;
      }
    }
  </style>
</head>

<body>

  <nav class="sidebar">
      <h2>üéÆ MyMovies</h2>
      <a href="/userDashboard" class="nav-link"><span class="material-icons">video_library</span>Recommendations</a>
      <a href="/watchlistpage/watlistmovies" class="nav-link active">
        <span class="material-icons">stars</span><span><%= user.name %>'s Watchlist</span>
      </a>

      <a href="/liked" class="nav-link"><span class="material-icons">favorite</span> Liked</a>
      <a href="/recent" class="nav-link"><span class="material-icons">history</span> Recently Watched</a>
    </nav>

  <div class="header">
    <h2>‚ù§Ô∏è Liked Movies</h2>
  </div>

  <div class="movie-grid">
    <% if (movies.length > 0) { %>
      <% movies.forEach((movie) => {
          let embedUrl = null;
          if (movie.movie_url && movie.movie_url.includes("youtube.com/watch?v=")) {
            embedUrl = movie.movie_url.replace("watch?v=", "embed/");
          } else if (movie.movie_url && movie.movie_url.includes("youtube.com/embed/")) {
            embedUrl = movie.movie_url;
          }
      %>
        <div class="movie-card">
          <div class="poster-wrapper">
            <img src="<%= movie.poster_url || '/images/default-poster.jpg' %>" 
                 class="movie-poster" 
                 alt="Movie Poster"
                 onerror="this.onerror=null; this.src='/images/default-poster.jpg';">
          </div>
          <h5 class="movie-title"><%= movie.title || 'Untitled' %></h5>
          <div class="overlay-buttons">
            <% if (movie.trailer_url) { %>
              <a href="<%= movie.trailer_url %>" target="_blank" class="btn">üé¨ Trailer</a>
            <% } else { %>
              <span class="btn disabled">No Trailer</span>
            <% } %>

            <% if (embedUrl) { %>
              <button onclick="handleWatchMovie('<%- embedUrl %>', <%= movie.movie_id %>)" class="btn">‚ñ∂ Watch</button>
            <% } else { %>
              <span class="btn disabled">Not Available</span>
            <% } %>
          </div>
        </div>
      <% }); %>
    <% } else { %>
      <p class="no-movies">No liked movies yet.</p>
    <% } %>
  </div>

  <!-- Video Modal -->
  <div id="videoModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; justify-content:center; align-items:center;">
    <div style="position:relative; width:90%; max-width:960px; background:#000;">
      <button onclick="closeModal()" style="position:absolute; top:10px; right:10px; z-index:10000; background:red; color:white; border:none; font-size:20px; cursor:pointer;">‚úñ</button>
      <iframe id="videoFrame" src="" frameborder="0" allowfullscreen style="width:100%; height:500px;"></iframe>
    </div>
  </div>

  <script>
    function handleWatchMovie(movieUrl, movieId) {
      const modal = document.getElementById("videoModal");
      const frame = document.getElementById("videoFrame");
      frame.src = movieUrl;
      modal.style.display = "flex";
    }

    function closeModal() {
      const modal = document.getElementById("videoModal");
      const frame = document.getElementById("videoFrame");
      frame.src = "";
      modal.style.display = "none";
    }
  </script>
</body>
</html>
